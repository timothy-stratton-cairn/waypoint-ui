<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body data-client-id="${clientId}">
<div th:insert="~{header :: main}">...</div>

<div class="container">
  <div id="messageBanner" class="alert" role="alert" style="display: none;"></div>

  <div id="householdSection" class="note_card">
    <fieldset>
      <legend>Household</legend>
      <div class="row mb-3">
        <div class="col-md-3">
          <label>Name:</label>
          <span th:text="${household.name}"></span>
        </div>
      </div>
      <div class="row mb-3" th:if="${primaryContact != null}">
        <div class="col-md-3">
          <label>Primary Contact:</label>
          <span th:text="${primaryContact.firstName + ' ' + primaryContact.lastName}"></span>
        </div>
        <div class="col-md-3">
          <label>Email:</label>
          <span th:text="${primaryContact.email}"></span>
        </div>
        <div class="row mb-3" th:if="${primaryContact == null}">
          <div class="col-md-12">
            <p>No primary contact available</p>
          </div>
        </div>
        <div class="row mb-3">
          <div class="col-md-12">
            <table class="table">
              <thead>
              <tr>
                <th>CoClients</th>
                <th>Action</th>
              </tr>
              </thead>
              <tbody>
              <tr th:each="coclient : ${coclients}">
                <td th:text="${coclient.firstName + ' ' + coclient.lastName}"></td>
                <td>
                  <a class="btn btn-sm btn-secondary"
                     th:href="${'javascript:editClient(' + coclient.id + ');'}">Edit</a>
                  <a class="btn btn-sm btn-secondary"
                     th:href="${'javascript:makePrimaryContact(' + coclient.id + ');'}">Make
                    Primary Contact</a>
                  <a class="btn btn-sm btn-default"
                     th:href="${'javascript:removeCoClient(' + coclient.id + ');'}">Remove
                    CoClient</a>
                </td>

              </tr>
              </tbody>
            </table>
          </div>
        </div>
        <button onclick="history.back()" class="btn btn-primary">Back</button>
        <br>
      </div>
    </fieldset>
  </div>

  <div class="note_card" id="coclientSection">
    <fieldset>
      <legend>CoClients</legend>

      <!-- CoClient Tabs -->
      <ul class="nav nav-tabs" id="coclientTabs" role="tablist">
        <li class="nav-item" th:each="coclient : ${coclients}">
          <a class="nav-link" href="javascript:void(0);"
             th:text="${coclient.firstName + ' ' + coclient.lastName}"
             th:onclick="|loadCoClientData(${coclient.id});|">CoClient</a>
        </li>
      </ul>

      <!-- Content Section for CoClient Information and Homework Questions -->
      <div class="tab-content mt-3" id="coclientContent">
        <div id="coclientInfo" class="mb-3">
          <p><strong>Name:</strong> <span id="coclientName"></span></p>
          <p><strong>Email:</strong> <span id="coclientEmail"></span></p>
        </div>

        <div id="questionListContainer">
          <ul class="list-group">
            <li class="list-group-item bg-light font-weight-bold">
              <div class="row">
                <div class="col-md-6">Question</div>
                <div class="col-md-3">Response</div>
                <div class="col-md-2">Protocol</div>
                <div class="col-md-1">Last Updated</div>
              </div>
            </li>
            <li class="list-group-item question-item" id="questionsList"></li>
          </ul>
        </div>
      </div>
    </fieldset>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script th:inline="javascript">
  var firstCoClientId = [[${firstCoClientId}]];

  function editClient(id) {
    window.location.href = '/changeClientInfo/' + id;
  }

  function loadCoClientData(coclientId) {
    $.ajax({
      url: `/getCoClientQuestionsAndProtocols/${coclientId}`,
      type: "GET",
      success: function(data) {
        $('#coclientName').text(data.coclient.firstName + ' ' + data.coclient.lastName);
        $('#coclientEmail').text(data.coclient.email);

        $('#questionsList').empty();
        data.Questions.questions.forEach(function(questionResponse) {
          $('#questionsList').append(`
            <li class="list-group-item">
              <div class="row">
                <div class="col-md-6"><strong>${questionResponse.question.question}</strong></div>
                <div class="col-md-3">${questionResponse.response ? questionResponse.response.response : 'NEEDS ATTENTION'}</div>
                <div class="col-md-2">${questionResponse.protocol.name}</div>
                <div class="col-md-1">${questionResponse.question.updated || 'N/A'}</div>
              </div>
            </li>
          `);
        });
      },
      error: function() {
        alert('Failed to load CoClient data.');
      }
    });
  }

  $(document).ready(function() {
    loadCoClientData(firstCoClientId);
  });
</script>

</body>
</html>
